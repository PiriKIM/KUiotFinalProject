# Flaskbook 디렉토리 가이드

## 📁 디렉토리 개요
`flaskbook` 디렉토리는 웹캠 기반 실시간 자세 분석 및 교정 피드백 시스템의 **Flask 웹 애플리케이션** 부분을 담당합니다. 사용자 인증, 자세 분석 데이터 저장, 통계 제공 등의 기능을 제공합니다.

---

## 🚀 실행 관련 파일

### `run.py`
- **기능**: Flask 애플리케이션 실행 스크립트
- **역할**: 
  - 애플리케이션 인스턴스 생성 및 실행
  - 개발 서버 시작 (host='0.0.0.0', port=5000)
  - 사용자 안내 메시지 출력
- **사용법**: `python run.py`

### `requirements.txt`
- **기능**: Python 패키지 의존성 목록
- **주요 패키지**:
  - `Flask>=2.0`: 웹 프레임워크
  - `Flask-SQLAlchemy>=3.0`: 데이터베이스 ORM
  - `opencv-python>=4.5.0`: 웹캠 영상 처리
  - `mediapipe>=0.10.0`: 자세 분석용
  - `gTTS>=2.3`: Google TTS (음성 피드백)

---

## 🗄️ 데이터베이스 관련 파일

### `init_db.py`
- **기능**: 데이터베이스 초기화 스크립트
- **역할**:
  - SQLite 데이터베이스 테이블 생성
  - 테스트 사용자 생성 (선택사항)
  - 초기 설정 완료 안내
- **사용법**: `python init_db.py`

### `create_test_data.py`
- **기능**: 테스트 데이터 생성 스크립트
- **역할**:
  - 가상의 자세 분석 기록 생성
  - 랜덤한 분석 결과로 테스트 환경 구축
  - 기존 기록 삭제 옵션 제공
- **사용법**: `python create_test_data.py`

### `local.sqlite`
- **기능**: SQLite 데이터베이스 파일
- **저장 데이터**:
  - 사용자 정보 (User 테이블)
  - 자세 분석 기록 (PostureRecord 테이블)

---

## 🏗️ 애플리케이션 구조

### `apps/app.py`
- **기능**: Flask 애플리케이션 팩토리
- **역할**:
  - Flask 인스턴스 생성 및 설정
  - 데이터베이스 연결 설정
  - Blueprint 등록 (crud, auth)
  - 정적 파일 경로 설정

### `apps/crud/__init__.py`
- **기능**: CRUD 모듈 초기화
- **역할**: Blueprint 등록 및 모듈 설정

---

## 📊 데이터 모델

### `apps/crud/models.py`
- **기능**: 데이터베이스 모델 정의
- **주요 클래스**:

#### `User` 클래스
- **필드**: id, username, email, password_hash, created_at, updated_at, last_login
- **기능**: 사용자 정보 관리, 비밀번호 해싱, 로그인 시간 추적

#### `PostureRecord` 클래스
- **필드**: 자세 분석 결과 (목, 척추, 어깨, 골반, 척추 틀어짐)
- **기능**: 
  - 종합 점수 계산 (`calculate_overall_score()`)
  - 등급 계산 (`calculate_overall_grade()`)
  - 5가지 자세 요소별 평가

---

## 🔐 인증 시스템

### `apps/crud/auth.py`
- **기능**: 사용자 인증 관련 라우트
- **주요 엔드포인트**:
  - `/auth/register`: 회원가입
  - `/auth/login`: 로그인
  - `/auth/logout`: 로그아웃
  - `/auth/profile`: 사용자 프로필

---

## 🎯 핵심 기능

### `apps/crud/views.py`
- **기능**: 메인 애플리케이션 라우트
- **주요 엔드포인트**:
  - `/crud/`: 메인 대시보드
  - `/crud/analyze`: 실시간 자세 분석 (POST)
  - `/crud/history`: 분석 기록 조회
  - `/crud/statistics`: 통계 및 차트

### `apps/crud/neck.py`
- **기능**: 자세 분석 알고리즘
- **분석 항목**:
  - 거북목 분석 (`analyze_turtle_neck_detailed`)
  - 척추 굴곡 분석 (`analyze_spine_curvature`)
  - 어깨 비대칭 분석 (`analyze_shoulder_asymmetry`)
  - 골반 기울기 분석 (`analyze_pelvic_tilt`)
  - 척추 틀어짐 분석 (`analyze_spine_twisting`)

---

## 🎨 프론트엔드

### `apps/templates/crud/`
- **HTML 템플릿 파일들**:
  - `index.html`: 메인 대시보드
  - `login.html`: 로그인 페이지
  - `register.html`: 회원가입 페이지
  - `profile.html`: 사용자 프로필
  - `history.html`: 분석 기록 목록
  - `statistics.html`: 통계 및 차트

### `apps/crud/static/`
- **정적 파일들**:
  - `style.css`: 스타일시트
  - `crud/script.js`: JavaScript 기능 (웹캠 연동, 실시간 분석)

---

## 📋 기타 파일

### `=0.10.0`
- **기능**: MediaPipe 버전 정보 파일
- **역할**: 의존성 버전 관리

### `instructions.md`
- **기능**: 프로젝트 사용법 및 개발 가이드
- **내용**: 설치, 실행, 개발 가이드

### `Directory.md`
- **기능**: 디렉토리 구조 설명
- **역할**: 프로젝트 구조 문서화

---

## 🔄 워크플로우

1. **초기 설정**: `init_db.py` → 데이터베이스 생성
2. **테스트 데이터**: `create_test_data.py` → 샘플 데이터 생성
3. **애플리케이션 실행**: `run.py` → 웹 서버 시작
4. **사용자 접속**: `http://localhost:5000/auth/login`
5. **자세 분석**: 웹캠을 통한 실시간 분석
6. **데이터 저장**: 분석 결과를 데이터베이스에 저장
7. **통계 확인**: 기록 조회 및 통계 분석

---

## 🛠️ 개발 환경

- **Python 3.x**
- **Flask 2.0+**
- **SQLite 데이터베이스**
- **MediaPipe 자세 분석**
- **OpenCV 웹캠 처리**

이 구조를 통해 사용자는 웹 브라우저를 통해 자세 분석 시스템에 접근하고, 개인별 분석 기록을 관리할 수 있습니다. 


## 📂 디렉토리 구조도

```
flaskbook/
├── 🚀 실행 파일
│   ├── run.py                    # Flask 애플리케이션 실행 스크립트
│   ├── requirements.txt          # Python 패키지 의존성
│   └── =0.10.0                  # MediaPipe 버전 정보
│
├── 🗄️ 데이터베이스
│   ├── init_db.py               # 데이터베이스 초기화
│   ├── create_test_data.py      # 테스트 데이터 생성
│   └── local.sqlite             # SQLite 데이터베이스 파일
│
├── 📋 문서
│   ├── instructions.md          # 프로젝트 사용법 가이드
│   ├── Directory.md             # 디렉토리 구조 설명
│   └── FLASKBOOK_GUIDE.md       # 이 파일 (상세 가이드)
│
└── 🏗️ 애플리케이션 (apps/)
    ├── app.py                   # Flask 애플리케이션 팩토리
    │
    ├── 📊 CRUD 모듈 (crud/)
    │   ├── __init__.py          # 모듈 초기화
    │   ├── models.py            # 데이터 모델 (User, PostureRecord)
    │   ├── views.py             # 메인 라우트 및 API
    │   ├── auth.py              # 사용자 인증 시스템
    │   ├── neck.py              # 자세 분석 알고리즘
    │   │
    │   ├── 🎨 정적 파일 (static/)
    │   │   ├── style.css        # 스타일시트
    │   │   └── crud/
    │   │       └── script.js    # JavaScript (웹캠 연동)
    │   │
    │   └── 📄 템플릿 (templates/crud/)
    │       ├── index.html       # 메인 대시보드
    │       ├── login.html       # 로그인 페이지
    │       ├── register.html    # 회원가입 페이지
    │       ├── profile.html     # 사용자 프로필
    │       ├── history.html     # 분석 기록 목록
    │       └── statistics.html  # 통계 및 차트
    │
    └── __pycache__/             # Python 캐시 파일
```

## 🔄 데이터 흐름 아키텍처

```
사용자 요청
    ↓
┌─────────────────────────────────────────────────────────────┐
│                    Flask 애플리케이션 (app.py)              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Auth      │  │    CRUD     │  │   Static Files      │  │
│  │ Blueprint   │  │  Blueprint  │  │   (CSS, JS)         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
    ↓                    ↓                    ↓
┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐
│   인증      │  │   자세 분석 │  │   프론트엔드        │
│   시스템    │  │   API       │  │   렌더링            │
└─────────────┘  └─────────────┘  └─────────────────────┘
    ↓                    ↓                    ↓
┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐
│  User 모델  │  │PostureRecord│  │   HTML 템플릿       │
│  (로그인)   │  │  (분석결과) │  │   (Jinja2)          │
└─────────────┘  └─────────────┘  └─────────────────────┘
    ↓                    ↓
┌─────────────────────────────────────────────────────────────┐
│                    SQLite 데이터베이스                      │
│  ┌─────────────┐  ┌─────────────────────────────────────┐  │
│  │   user      │  │        posture_record               │  │
│  │   테이블    │  │         테이블                      │  │
│  └─────────────┘  └─────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 🎯 핵심 기능별 아키텍처

### 1. 🔐 인증 시스템
```
사용자 → login.html → auth.py → User 모델 → SQLite
  ↓
세션 관리 → 로그인 상태 유지 → 보호된 페이지 접근
```

### 2. 📹 실시간 자세 분석
```
웹캠 → script.js → views.py → neck.py → PostureRecord → SQLite
  ↓
분석 결과 → JSON 응답 → 프론트엔드 표시
```

### 3. 📊 데이터 관리
```
사용자 요청 → views.py → PostureRecord 모델 → SQLite
  ↓
통계 계산 → 템플릿 렌더링 → HTML 응답
```

## 🛠️ 기술 스택 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                    프론트엔드 레이어                        │
│  HTML5 + CSS3 + JavaScript (웹캠 API, Canvas)              │
└─────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────┐
│                    웹 프레임워크 레이어                     │
│  Flask + Jinja2 + Blueprint + SQLAlchemy                   │
└─────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────┐
│                    자세 분석 레이어                         │
│  MediaPipe + OpenCV + NumPy + 수학적 알고리즘              │
└─────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────┐
│                    데이터 저장 레이어                       │
│  SQLite + SQLAlchemy ORM + 데이터 모델                     │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 개발 환경 설정 순서

```
1. 📦 패키지 설치
   pip install -r requirements.txt

2. 🗄️ 데이터베이스 초기화
   python init_db.py

3. 📊 테스트 데이터 생성 (선택사항)
   python create_test_data.py

4. 🚀 애플리케이션 실행
   python run.py

5. 🌐 브라우저 접속
   http://localhost:5000/auth/login
```

