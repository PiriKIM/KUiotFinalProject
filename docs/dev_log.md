# 개발 일지 (Development Log)

## 향후 작업 계획

### 🎯 주요 목표
- 실시간 자세 분석 시스템 완성도 향상
- 사용자 경험 개선 및 안정성 확보
- 수집된 데이터를 활용한 머신러닝 모델 개발

### 📋 작업 항목

#### 1. 데이터 수집 및 분석 시스템 고도화
- [ ] **데이터 품질 개선**
  - 수집된 395개 레코드 데이터 품질 검증
  - 정면/측면 라벨링 정확도 검토 및 재라벨링
  - 노이즈 데이터 필터링 알고리즘 적용

- [ ] **다양한 사람 데이터 수집**
  - 현재 P1 데이터만 있으므로 P2, P3 등 추가 사람 데이터 수집
  - 체형별, 연령대별 데이터 다양성 확보
  - 각 사람별 정면/측면 데이터 균형 맞추기
  - **팀원 전체 테스트 계획**
    - 팀원 5명이 각각 P1, P2, P3, P4, P5 로 구분하여 데이터 수집
    - 각 팀원별로 정면/측면 자세 데이터 균형 있게 수집 (각각 50-100개씩)
    - 체형, 키, 자세 습관 등 개인차를 반영한 다양한 데이터 확보
    - 팀원별 테스트 일정 및 역할 분담 계획 수립

- [ ] **현재 v1 랜드마크 기반 분석 정밀도 향상**
  - 33개 랜드마크를 활용한 더 정교한 자세 분석 알고리즘 개발
  - 랜드마크 간 관계성 분석 강화
  - 자세 상태 판별 정확도 개선

#### 2. 머신러닝 모델 개발
- [ ] **정면/측면 분류 모델 구현**
  - 수집된 데이터를 활용한 지도학습 모델 개발
  - KNN, SVM, 랜덤포레스트 등 다양한 알고리즘 비교
  - 교차 검증을 통한 모델 성능 평가

- [ ] **실시간 자세 분류 시스템**
  - 학습된 모델을 실시간 웹캠 스트림에 적용
  - 수동 라벨링 없이 자동으로 정면/측면 판별
  - 분류 결과 시각화 및 피드백 제공

- [ ] **모델 성능 최적화**
  - 하이퍼파라미터 튜닝
  - 특성 선택 및 엔지니어링
  - 모델 앙상블 기법 적용

#### 3. 자세 분석 알고리즘 최적화
- [ ] **목 자세 분석 정확도 향상**
  - 현재 거북목 감지 임계값 조정
  - 목 각도 계산 방식 개선
  - 안정화 시간 조정 (현재 20프레임 → 최적값 찾기)

- [ ] **골반 자세 분석 추가**
  - 골반 기울기 감지
  - 골반 회전 분석
  - 골반-어깨 정렬 확인

- [ ] **척추 기울기 분석 추가**
  - 척추 중심선 기울기 측정
  - 척추 굽힘 정도 분석
  - 척추-골반 정렬 확인

#### 4. 프론트엔드 UI/UX 개선
- [ ] **캔버스 깜빡임 문제 해결**
  - Canvas 렌더링 최적화
  - 더블 버퍼링 적용
  - 프레임 스킵 로직 개선
  - GPU 가속 활용

- [ ] **점수 표시 대신 상태 알림 시스템**
  - 실시간 점수 표시 제거 (집중도 저하 방지)
  - 자세 상태별 간단한 알림 메시지
  - 문제가 있을 때만 알림 표시
  - 학습/업무 중 방해 최소화

- [ ] **분석 결과 시각화 개선**
  - 자세별 상세 점수 표시
  - 개선 방향 가이드 추가
  - 히스토리 차트 구현

- [ ] **사용자 피드백 시스템**
  - 자세 교정 운동 가이드
  - 실시간 피드백 메시지 개선
  - 알림 시스템 추가

- [ ] **반응형 디자인 최적화**
  - 모바일 터치 인터페이스 개선
  - 태블릿 레이아웃 최적화
  - 접근성 향상

#### 5. 백엔드 시스템 강화
- [ ] **데이터베이스 스키마 개선**
  - 자세 분석 결과 상세 저장
  - 사용자별 통계 데이터 구조화
  - 성능 최적화

- [ ] **API 엔드포인트 추가** 
  - 자세 히스토리 조회 API
  - 통계 데이터 API
  - 사용자 설정 API

- [ ] **에러 처리 및 로깅**
  - MediaPipe 에러 처리 개선
  - 사용자 친화적 에러 메시지
  - 디버깅 로그 시스템

#### 6. 성능 최적화
- [ ] **실시간 처리 성능 향상**
  - FPS 최적화 (목표: 30fps 이상)
  - 메모리 사용량 최적화
  - CPU 사용률 개선

- [ ] **네트워크 최적화**
  - 이미지 압축 알고리즘 적용
  - WebSocket 연결 안정성 향상
  - 대역폭 사용량 최적화

### 🔧 기술적 고려사항

#### MediaPipe 최적화
- Pose 모델 설정 조정
- 랜드마크 필터링 최적화
- 프레임 스킵 로직 개선

#### 브라우저 호환성
- Chrome, Firefox, Safari 테스트
- 모바일 브라우저 최적화
- WebRTC API 호환성 확인

#### 보안 및 개인정보
- 웹캠 데이터 보안 강화
- 사용자 데이터 암호화
- GDPR 준수 확인

### 📊 성능 목표
- **실시간 분석**: 30fps 이상 유지
- **정확도**: 90% 이상의 자세 감지 정확도
- **응답 시간**: 100ms 이하의 분석 응답
- **안정성**: 99% 이상의 시스템 가동률

### 🚀 다음 단계
1. 팀원 전체 테스트를 통한 다양한 사람 데이터 수집
2. 머신러닝 모델 개발 및 학습
3. 자세 분석 알고리즘 테스트 및 검증
4. 사용자 테스트 진행
5. 피드백 수집 및 반영
6. 최종 배포 준비

---

## 완료된 작업

### 2025-06-28 23:00
- ✅ **자세 라벨링 기반 랜드마크 데이터 수집 기능 구현**
  - 정면/측면 상태 감지 정밀도 향상을 위해 MediaPipe의 랜드마크 좌표 데이터를 DB에 저장하는 시스템 개발
  - 10프레임마다 1회 분석 및 저장하여 시스템 리소스 낭비를 줄이고 효율성 향상
  - SQLite 기반 pose_landmarks 테이블 생성: timestamp, label(자세 상태: 1=정면, 2=측면, 3=제외), landmark_0_x ~ landmark_32_y까지 총 66개 좌표 저장
  - 실시간 키보드 입력 기반 라벨링 기능 추가: 1: 정면, 2: 측면, 3: 제외 상태
  - **visibility가 0.5 미만인 관절은 (-1, -1)로 저장하여 학습 데이터 품질 확보**
  - **person_id 컬럼 추가로 여러 사람(P1, P2, P3...) 데이터 구분 가능**
  - **키보드 'P' 입력으로 사람 식별자 변경 기능**
  - **사람별, 라벨별로 분리된 CSV 파일 생성 및 test/data 폴더에 저장**
  - 수집된 데이터는 향후 정면/측면 분류 머신러닝 모델 학습용 데이터셋으로 활용 예정

- ✅ **MediaPipe Pose v1/v2 랜드마크 비교 자료조사**
  - Pose v1: 총 33개 랜드마크 (현재 사용 중)
  - Pose v2: 총 38개 랜드마크 (v1 + 5개 추가)
  - v2 추가 포인트: 골반 중심(MIDHIP) 및 발 앞쪽(FOREFOOT) 관련 포인트
  - v2는 하체 균형 및 보행 정렬 분석에 더 정밀한 분석 가능
  - 향후 자세 분석 정확도 향상을 위해 v2 업그레이드 고려

**🔧 관련 기술 요소**
- MediaPipe Pose 33개 랜드마크 추출
- OpenCV 웹캠 영상 처리 및 키보드 이벤트
- SQLite3로 시계열 자세 데이터 저장
- 10프레임 간격 처리 로직으로 성능 최적화
- 감지 신뢰도(visibility) 기반 결측값 처리 로직 적용

**📌 향후 활용 계획**
- 수집된 데이터를 기반으로 정면/측면 분류 모델(KNN, SVM, 랜덤포레스트 등) 학습
- 정면 vs 측면 실시간 자동 분류 기능 적용
- 수동 라벨링 없이도 자세 상태 판별 가능하도록 시스템 자동화
- 현재 v1 랜드마크를 활용한 더 정교한 자세 분석 알고리즘 개발

### 2025-06-27
- ✅ 기존 Canvas 기반 실시간 스켈레톤 시각화 코드를 `PoseStateManager` 기반의 상태 관리 흐름에 통합
- ✅ 거북목 진단 기준 조사
- ✅ 자세 분석 알고리즘 고도화를 위해 기존 코드를 재검토  
- ✅ 자세 단계를 나눠 실측 테스트 및 결과 캡처 기반 분석을 병행

### 2025-06-26
- ✅ 실시간 스켈레톤 시각화 시스템 구현
- ✅ Canvas 오버레이 시스템 추가
- ✅ 랜드마크 데이터 전송 기능 구현
- ✅ 상태 관리 시스템 완성
- ✅ 반응형 UI/UX 디자인 구현
- ✅ 한글 폰트 렌더링 시스템 구축

---

## 참고 자료
- MediaPipe Pose Documentation
- Flask WebSocket Implementation
- HTML5 Canvas API Reference
- WebRTC API Documentation